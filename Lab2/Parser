import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.util.*;
import java.util.logging.Level;
import java.util.logging.Logger;
import Exceptions.*;


public class Parser {
    static Logger logger = Logger.getLogger(Parser.class.getName());

    public Parser() {
        options = new HashMap<>();
        sequence = new Vector<>();
    }

    public Map<String, Vector<String>> getOptions() {
        return options;
    }
    public Vector<String> getSequence() {
        return sequence;
    }

    private final Map<String, Vector<String>> options;   
    private final Vector<String> sequence;

    public void parseFile(String fileName) throws Exception {
        logger.info("File is parsing..");
        boolean IndicateCsed = false;
        File file = new File(fileName);
        BufferedReader in = new BufferedReader(new FileReader(file));   
        String line = in.readLine();
        if (!line.equals("desc")){
            logger.log(Level.WARNING, "Wrong format because of lack the desc");
            throw new IncorrectWorkflow("Wrong format");
        }

        while (in.ready()) {
            Vector<String> args = new Vector<>();
            line = in.readLine();
            String[] WordsInCurStr  = line.split(" ");
            Collections.addAll(args, WordsInCurStr );
            if ((args.get(0).equals("csed")) && (args.size() == 1)) {
                IndicateCsed = true;
                break;
            }
            String key = args.get(0);
            args.remove(0);
            args.remove(0);
            options.put(key, args);
        }

        if (!IndicateCsed) {
            logger.log(Level.WARNING, "The csed wasn't found, you need to add it");
            throw new IncorrectWorkflow("The csed wasn't found");
        }
        line = in.readLine();
        if (line.equals("")) {
            logger.log(Level.WARNING, "Option sequence wasn't found");
            throw new IncorrectWorkflow("Option sequence wasn't found");
        }
        String[] WordsInCurStr = line.split(" ");
        for(int i = 0; i <WordsInCurStr.length; i++){
            if (i % 2 != 0 && !WordsInCurStr[i].equals("->")) {
                logger.log(Level.WARNING, "Wrong sequence format because of -> was needed between operations");
                throw new IncorrectSequence("Wrong sequence format");
            }
            if (i % 2 == 0 && !WordsInCurStr[i].equals("->")) sequence.add(WordsInCurStr[i]);
        }
        in.close();
        logger.info("Parsing file is finished");
    }
}
